[p2p]
# DHT and P2P Configuration
dht_port = 30609
# Custom bootstrap nodes (our network) - used for both DHT and QUIC identity exchange
custom_bootstrap_nodes = 159.65.253.245:30609, 167.86.116.185:30609
# Global DHT bootstrap nodes (public BitTorrent DHT) - used only for DHT routing
dht_bootstrap_nodes = 159.65.253.245:30609, 167.86.116.185:30609, router.utorrent.com:6881, router.bittorrent.com:6881, dht.transmissionbt.com:6881, dht.aelitis.com:6881, router.silotis.us:6881, dht.libtorrent.org:25401, dht.anacrolix.link:42069, router.bittorrent.cloud:42069
# Enable BEP_44 DHT storage (default: true, can be disabled with -s=false flag)
enable_bep44_store = true

# QUIC Configuration
quic_port = 30906
quic_listen_addr = 0.0.0.0
quic_connection_timeout = 30m
quic_keepalive_period = 10s
quic_stream_open_timeout = 5s

# Peer Discovery
peer_discovery_interval = 30s
peer_maintenance_interval = 5m
peer_validation_interval_hours = 24
# Network info refresh interval (in minutes) - how often to refresh NAT/relay status for all known peers
# This catches relay connection/disconnection changes more quickly than stale peer validation
# Default: 30 minutes (range: 5-240 minutes)
peer_network_refresh_interval_minutes = 30
maintenance_interval = 1h

[topics]
# Topics to subscribe to (comma-separated)
subscribe_topics = remote-network-mesh
# Topic announcement interval
topic_announce_interval = 60s

[network]
# Network buffer size
buffer_size = 65536

[log]
# Logging Configuration
logfile = remote-network
log_level = debug
log_max_size_mb = 100
log_max_age_days = 30
log_max_backups = 10
log_rotation_interval = daily
log_enable_rotation = true

[misc]
# Miscellaneous settings
pid_path = ./remote-network.pid
# Port for pprof profiling (0 = disabled)
pprof_port = 6060
# Fallback ports for pprof if primary is unavailable (comma-separated)
pprof_fallback_ports = 6061,6062

[api]
# API Server Configuration
api_port = 30069
# Fallback ports for API server if primary is unavailable (comma-separated)
api_fallback_ports = 30096,36009
# Use HTTPS for API server (recommended for production)
api_use_https = true
# Enable HTTP server on localhost (convenient for local access without SSL warnings)
api_http_localhost = true
# Port for HTTP localhost server (only binds to 127.0.0.1)
api_http_port = 36900

[database]
# Database configuration
database_file = remote-network.db
# Clean up old relay sessions after 24 hours
relay_session_cleanup_hours = 24

[nat]
# NAT Detection and Classification
nat_stun_servers = stun.l.google.com:19302, stun1.l.google.com:19302, stun2.l.google.com:19302
nat_stun_timeout = 3s
nat_stun_buffer_size = 1024
nat_test_hairpinning = true
nat_default_filtering = address-port-dependent
nat_port_prediction_samples = 3
nat_port_prediction_max_diff = 10
nat_hairpinning_timeout = 2s

# Network State Monitoring
# How often to check for IP/NAT changes (in minutes)
# When changes are detected, triggers automatic metadata republishing:
#  - Public nodes: Update and republish metadata with new IP
#  - NAT nodes: Disconnect from relay, re-select relay, reconnect, then republish with new relay info
network_monitor_interval_minutes = 5

[relay]
# Relay Service Configuration
relay_mode = false
relay_max_connections = 100
relay_connection_keepalive = 30s
relay_keepalive_interval = 5s
relay_pricing_per_gb = 0.001
relay_free_coordination = true
relay_max_coordination_msg_size = 10240
relay_batch_interval = 30s
relay_traffic_batch_size = 100
relay_capacity = 1000

# Store-and-Forward Configuration
# Enable message queuing for offline peers (default: true)
relay_store_enabled = true
# Maximum messages to store per peer (0 = unlimited, default: 1000)
relay_store_max_messages = 1000
# Maximum storage size per peer in bytes (default: 100MB)
relay_store_max_bytes = 104857600
# Maximum single message size for store-and-forward in bytes (default: 10MB)
relay_store_max_message_size = 10485760
# Cleanup interval for expired messages (default: 1h)
relay_cleanup_interval = 1h
# Default TTL for messages without specific TTL (default: 24h)
relay_ttl_default = 24h

# TTL overrides per message type (optional)
# Payment messages (7 days)
relay_ttl_invoice_request = 168h
relay_ttl_invoice_response = 168h
relay_ttl_invoice_notify = 168h
# Job updates (24 hours)
relay_ttl_job_status_update = 24h
# Job results (48 hours)
relay_ttl_job_response = 48h
relay_ttl_service_response = 48h
relay_ttl_capabilities_response = 48h

# Relay Selection (for NAT peers)
# Max latency set to 5s to match ping timeout (allows relays that respond within timeout window)
relay_max_latency = 5s
relay_min_reputation = 0.3
relay_max_pricing = 0.01
relay_switch_threshold = 0.2
relay_evaluation_interval = 5m

[hole_punch]
# Hole Punching / NAT Traversal Configuration
hole_punch_enabled = true
hole_punch_stream_timeout = 60s
hole_punch_direct_dial_timeout = 5s

# LAN Detection
hole_punch_lan_detection_enabled = true
hole_punch_lan_subnet_mask = 24

[dht]
# DHT-Based Metadata Architecture (Phase 1-6)
# Replaces old broadcast and peer exchange systems

# Metadata republishing to DHT (BEP_44) - 60 minutes (1 hour) to keep DHT data fresh
metadata_republish_interval_minutes = 60
# BEP_44 item expiration in hours - how long DHT nodes keep stored items before deleting
# Should be at least 2x the republish interval (default: 2 hours per BEP_44 spec)
bep44_item_expiration_hours = 2

[metadata_retry]
# Metadata retry scheduler configuration for failed metadata fetches
# Max retry attempts before deleting peer from database
metadata_fetch_retry_count = 5
# Retry interval in seconds (default: 3 minutes)
metadata_fetch_retry_interval = 180
# Max age in seconds without metadata before deleting peer (default: 1 hour)
metadata_fetch_max_age = 3600

[peer_discovery]
# On-demand peer discovery using DHT queries
# Periodic DHT discovery interval: 3 hours (how often to run full DHT rediscovery)
periodic_discovery_interval_hours = 3
# Periodic bootstrap re-query interval: 3 hours (how often to re-query bootstrap peers for updated peer lists)
periodic_bootstrap_requery_interval_hours = 3

[tokens]
# Token Contract Addresses and Program IDs
# EVM Token Contracts (USDC ERC-3009 compliant)
token_usdc_base_sepolia = 0x036CbD53842c5426634e7929541eC2318f3dCF7e
token_usdc_base = 0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913
token_usdc_ethereum_sepolia = 0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238
token_usdc_ethereum = 0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48

# Solana Token Mints (USDC SPL)
token_usdc_solana = EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v
token_usdc_solana_devnet = 4zMMC9srt5Ri5X14GAgXhaHii3GnPAEERYPJgZJDncDU

# Solana Program IDs
solana_associated_token_program = ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL
solana_token_program = TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA
solana_system_program = 11111111111111111111111111111111

# Token EIP-712 Domain Parameters (for ERC-3009 signing)
# Format: token_{currency}_{network}_name and token_{currency}_{network}_version
# NOTE: Use official EIP-712 domain name from Circle (must be "USDC" not "USD Coin")
token_usdc_base_sepolia_name = USDC
token_usdc_base_sepolia_version = 2
token_usdc_base_name = USDC
token_usdc_base_version = 2
token_usdc_ethereum_sepolia_name = USDC
token_usdc_ethereum_sepolia_version = 2
token_usdc_ethereum_name = USDC
token_usdc_ethereum_version = 2

[invoices]
# Invoice delivery retry configuration
# Max retry attempts for invoice delivery (0-10, default: 3)
invoice_max_retries = 1
# Retry backoff in milliseconds (500-10000, default: 2000)
invoice_retry_backoff_ms = 1000

[x402]
# x402 Payment Protocol Configuration
# Payment is MANDATORY for all services with price > 0
# To offer free services, set pricing to 0 USDC
# - Service pricing: Set in service configuration (0 = free, >0 = requires payment)
# - Relay pricing: Set via relay_pricing_per_gb (0 = free, >0 = requires payment)

# Facilitator Configuration
# Any x402-compliant facilitator can be used by setting the URL below
# Signature Format: EIP-712 typed structured data signing (for EVM chains)
# Examples:
#   - https://www.x402.org/facilitator (official x402 facilitator)
x402_facilitator_url = https://facilitator.remote.network
x402_verify_endpoint = /verify
x402_settle_endpoint = /settle
x402_refund_endpoint = /refund
x402_version = v2

# Network Configuration
x402_network = testnet

# Default payment network (must match your default wallet type)
# For EVM wallets (Base, Ethereum, etc.)
x402_chain_id = eip155:84532
# Mainnet: eip155:8453

# For Solana wallets (uncomment to use Solana as default)
# x402_chain_id = solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1  # Solana Devnet (x402 supported)
# x402_chain_id = solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp  # Solana Mainnet (x402 supported)
# NOTE: Solana Testnet (solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z) is NOT supported by x402 facilitator

# IMPORTANT: Payment network (x402_chain_id) MUST match your default wallet's network
# - If using EVM wallet → set x402_chain_id to eip155:*
# - If using Solana wallet → set x402_chain_id to solana:*
# Mismatch will cause "network mismatch" errors when signing payments

# Timeouts and Limits
x402_timeout_seconds = 10
x402_max_retries = 3
x402_retry_backoff_ms = 1000

# Minimum payment amount in USDC (not ETH)
# Services with price > 0 but < minimum will be rejected
x402_min_payment_amount = 0.01

# Fail Mode (if facilitator unavailable)
x402_fail_mode = closed